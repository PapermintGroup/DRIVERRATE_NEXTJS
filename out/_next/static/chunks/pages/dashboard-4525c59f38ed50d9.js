(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{1075:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return i(3599)}])},3599:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Dashboard}});var l=i(5893),r=i(7294),a=i(1163);function Dashboard(){let[e,t]=(0,r.useState)([]),[i,c]=(0,r.useState)([]),[p,u]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[g,y]=(0,r.useState)(""),[x,b]=(0,r.useState)(""),[m,v]=(0,r.useState)(""),[j,S]=(0,r.useState)(""),[C,w]=(0,r.useState)(""),[P,k]=(0,r.useState)(""),[R,T]=(0,r.useState)(""),[D,N]=(0,r.useState)(""),[A,E]=(0,r.useState)(""),[z,U]=(0,r.useState)([]),[F,O]=(0,r.useState)(""),[I,_]=(0,r.useState)(!1),[W,J]=(0,r.useState)(null),[L,M]=(0,r.useState)({}),[q,B]=(0,r.useState)(null),V=(0,a.useRouter)();(0,r.useEffect)(()=>{!async function(){try{let e=await fetch("/api/me"),i=await e.json();if(!i.ok)return V.push("/login");if("admin"!==i.user.role)return V.push("/");B(i.user);let l=await fetch("/api/drivers"),r=await l.json();t(r.drivers||[]);let a=await fetch("/api/admin/users"),n=await a.json();c(n.users||[])}catch(e){V.push("/login")}}()},[]);let handleMultipleFileUploads=async function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l=Array.from(e.target.files);if(!l.length)return;if(i.length+l.length>6){alert("Maximum 6 vehicle pictures allowed");return}_(!0);let r=[...i];try{for(let e of l){let t=new FormData;t.append("file",e);let i=await fetch("/api/upload",{method:"POST",body:t}),l=await i.json();l.url&&r.push(l.url)}t(r)}catch(e){alert("Error uploading one or more files")}finally{_(!1)}},handleFileUpload=async(e,t)=>{let i=e.target.files[0];if(!i)return;_(!0);let l=new FormData;l.append("file",i);try{let e=await fetch("/api/upload",{method:"POST",body:l}),i=await e.json();i.url?t(i.url):alert("Upload failed")}catch(e){alert("Error uploading file")}finally{_(!1)}};async function create(e){e.preventDefault();let t={name:p,companyName:h||"",serviceAreas:g||"",profilePhoto:x||"",email:m||"",phone:j||"",routes:C||"",facebook:P||"",instagram:R||"",twitter:D||"",whatsapp:A||"",vehiclePics:z.length>0?JSON.stringify(z):null,idPic:F||null},i=await fetch("/api/drivers/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),l=await i.json();l.ok?(alert("Driver profile created successfully!"),window.location.reload()):alert(l.error||"Error creating profile")}async function toggleSubscription(e,t){let l=await fetch("/api/admin/activate-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,status:!t})});l.ok&&c(i.map(i=>i.id===e?{...i,isSubscribed:!t,paymentRequested:!1}:i))}async function rejectPayment(e){if(!confirm("Are you sure you want to reject this proof? The user will need to upload it again."))return;let t=await fetch("/api/admin/reject-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})});t.ok&&(c(i.map(t=>t.id===e?{...t,paymentRequested:!1,popUrl:null}:t)),alert("Payment request rejected and cleared."))}async function saveEdit(){let i={...L,vehiclePics:JSON.stringify(L.vehiclePics)},l=await fetch("/api/drivers/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),r=await l.json();r.ok?(t(e.map(e=>e.id===W?r.driver:e)),J(null),alert("Updated successfully")):alert(r.error||"Error updating")}async function deleteProfile(i){if(!i)return alert("Driver ID missing");if(!confirm("Are you sure you want to delete this profile?"))return;let l=await fetch("/api/drivers/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i})}),r=await l.json();r.ok?t(e.filter(e=>e.id!==i)):alert(r.error||"Error deleting")}async function logout(){await fetch("/api/auth/logout",{method:"POST"}),V.push("/login")}return q?(0,l.jsxs)("div",{style:{maxWidth:900,margin:"24px auto",padding:16,fontFamily:"Arial, sans-serif"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("h2",{style:{color:"#2d9a4a"},children:"Admin Dashboard"}),(0,l.jsxs)("div",{style:{display:"flex",gap:15,alignItems:"center"},children:[(0,l.jsxs)("span",{style:{fontSize:14},children:["Role: ",(0,l.jsx)("b",{children:q.role})]}),(0,l.jsx)("button",{onClick:logout,style:{background:"#ff4d4d",color:"#fff",border:"none",padding:"6px 12px",borderRadius:4,cursor:"pointer"},children:"Logout"})]})]}),(0,l.jsxs)("section",{style:{marginTop:20,background:"#fff5f5",padding:20,borderRadius:10,border:"2px solid #feb2b2",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[(0,l.jsx)("h3",{style:{margin:0,color:"#9b2c2c"},children:"Payment Notification Portal"}),(0,l.jsxs)("div",{style:{background:"#9b2c2c",color:"#fff",padding:"4px 10px",borderRadius:20,fontSize:12,fontWeight:"bold"},children:[i.filter(e=>e.paymentRequested&&!e.isSubscribed).length," Pending Alerts"]})]}),(0,l.jsx)("p",{style:{fontSize:13,color:"#4a5568",marginBottom:15},children:"The list below shows users who have notified the system of a manual EFT payment."}),(0,l.jsx)("div",{style:{maxHeight:300,overflowY:"auto",background:"#fff",borderRadius:8,border:"1px solid #fed7d7"},children:0===i.filter(e=>"admin"!==e.role).length?(0,l.jsx)("p",{style:{padding:20,textAlign:"center",color:"#a0aec0"},children:"No users found."}):i.filter(e=>"admin"!==e.role).map(e=>(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 15px",borderBottom:"1px solid #fed7d7",alignItems:"center"},children:[(0,l.jsxs)("div",{style:{fontSize:14},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,l.jsx)("b",{style:{color:"#2d3748"},children:e.name}),e.paymentRequested&&!e.isSubscribed&&(0,l.jsx)("span",{style:{background:"#fef3c7",color:"#92400e",padding:"2px 8px",borderRadius:4,fontSize:11,fontWeight:"bold",border:"1px solid #f59e0b"},children:"⚠️ NOTIFIED PAID"})]}),(0,l.jsx)("div",{style:{fontSize:12,color:"#718096"},children:e.email}),e.popUrl&&(0,l.jsx)("div",{style:{marginTop:6},children:(0,l.jsx)("a",{href:e.popUrl,target:"_blank",rel:"noopener noreferrer",style:{fontSize:11,color:"#2d9a4a",fontWeight:"bold",textDecoration:"underline"},children:"\uD83D\uDCC4 View Proof of Payment (POP)"})}),(0,l.jsxs)("div",{style:{fontSize:11,marginTop:4,fontWeight:"bold",color:e.isSubscribed?"#2d9a4a":"#e53e3e"},children:["Status: ",e.isSubscribed?"✅ Active Member":"❌ Access Restricted"]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:10},children:[e.paymentRequested&&!e.isSubscribed&&(0,l.jsx)("button",{onClick:()=>rejectPayment(e.id),style:{background:"#fff",color:"#e53e3e",border:"1px solid #e53e3e",padding:"8px 16px",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:"bold"},children:"Reject POP"}),(0,l.jsx)("button",{onClick:()=>toggleSubscription(e.id,e.isSubscribed),style:{background:e.isSubscribed?"#edf2f7":"#2d9a4a",color:e.isSubscribed?"#4a5568":"#fff",border:e.isSubscribed?"1px solid #cbd5e0":"none",padding:"8px 16px",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:"bold"},children:e.isSubscribed?"Revoke Access":"Approve EFT"})]})]},e.id))})]}),(0,l.jsxs)("form",{onSubmit:create,style:{display:"grid",gap:10,marginTop:40,background:"#f0fdf4",padding:20,borderRadius:10,border:"1px solid #dcfce7"},children:[(0,l.jsx)("h4",{style:{margin:0,color:"#166534"},children:"Add New Driver Listing"}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,l.jsx)("input",{placeholder:"Driver Full Name",value:p||"",onChange:e=>u(e.target.value),style:n,required:!0}),(0,l.jsx)("input",{placeholder:"Company Name (optional)",value:h||"",onChange:e=>f(e.target.value),style:n}),(0,l.jsx)("input",{placeholder:"Driver Email",value:m||"",onChange:e=>v(e.target.value),style:n}),(0,l.jsx)("input",{placeholder:"Phone Number",value:j||"",onChange:e=>S(e.target.value),style:n})]}),(0,l.jsx)("input",{placeholder:"Service Areas (e.g. Durban North, Umhlanga)",value:g||"",onChange:e=>y(e.target.value),style:n}),(0,l.jsx)("input",{placeholder:"Main Routes Description",value:C||"",onChange:e=>w(e.target.value),style:n}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,l.jsx)("input",{placeholder:"Facebook URL",value:P||"",onChange:e=>k(e.target.value),style:n}),(0,l.jsx)("input",{placeholder:"Instagram URL",value:R||"",onChange:e=>T(e.target.value),style:n}),(0,l.jsx)("input",{placeholder:"Twitter/X URL",value:D||"",onChange:e=>N(e.target.value),style:n}),(0,l.jsx)("input",{placeholder:"WhatsApp Number",value:A||"",onChange:e=>E(e.target.value),style:n})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginTop:10},children:[(0,l.jsxs)("div",{style:s,children:[(0,l.jsx)("label",{style:d,children:"Profile Photo"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>handleFileUpload(e,b)}),x&&(0,l.jsx)("span",{style:{color:"green",fontSize:10},children:"✓ Ready"})]}),(0,l.jsxs)("div",{style:s,children:[(0,l.jsx)("label",{style:d,children:"Vehicle Photos (Max 6)"}),(0,l.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>handleMultipleFileUploads(e,U,z)}),(0,l.jsxs)("span",{style:{fontSize:10,color:"#666"},children:[z.length,"/6 uploaded"]}),z.length>0&&(0,l.jsx)("button",{type:"button",onClick:()=>U([]),style:{fontSize:9,background:"none",border:"none",color:"red",cursor:"pointer"},children:"Clear all"})]}),(0,l.jsxs)("div",{style:s,children:[(0,l.jsx)("label",{style:d,children:"ID Document"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>handleFileUpload(e,O)}),F&&(0,l.jsx)("span",{style:{color:"green",fontSize:10},children:"✓ Ready"})]})]}),(0,l.jsx)("button",{disabled:I,style:o,children:I?"Processing Images...":"Create Listing"})]}),(0,l.jsxs)("section",{style:{marginTop:32},children:[(0,l.jsxs)("h3",{style:{borderBottom:"2px solid #2d9a4a",paddingBottom:8},children:["Registered Drivers (",e.length,")"]}),e.map(e=>{var t;return(0,l.jsx)("div",{style:{border:"1px solid #eee",padding:15,borderRadius:8,marginBottom:12,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",background:"#fff"},children:W===e.id?(0,l.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,l.jsx)("input",{placeholder:"Full Name",value:L.name||"",onChange:e=>M({...L,name:e.target.value}),style:n}),(0,l.jsx)("input",{placeholder:"Company Name",value:L.companyName||"",onChange:e=>M({...L,companyName:e.target.value}),style:n}),(0,l.jsx)("input",{placeholder:"Email",value:L.email||"",onChange:e=>M({...L,email:e.target.value}),style:n}),(0,l.jsx)("input",{placeholder:"Phone",value:L.phone||"",onChange:e=>M({...L,phone:e.target.value}),style:n})]}),(0,l.jsx)("input",{placeholder:"Service Areas",value:L.serviceAreas||"",onChange:e=>M({...L,serviceAreas:e.target.value}),style:n}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,l.jsx)("input",{placeholder:"Facebook",value:L.facebook||"",onChange:e=>M({...L,facebook:e.target.value}),style:n}),(0,l.jsx)("input",{placeholder:"Instagram",value:L.instagram||"",onChange:e=>M({...L,instagram:e.target.value}),style:n})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginTop:10},children:[(0,l.jsxs)("div",{style:s,children:[(0,l.jsx)("label",{style:d,children:"Update Profile Photo"}),(0,l.jsx)("input",{type:"file",onChange:e=>handleFileUpload(e,e=>M({...L,profilePhoto:e}))})]}),(0,l.jsxs)("div",{style:s,children:[(0,l.jsx)("label",{style:d,children:"Update Vehicle Photos (Max 6)"}),(0,l.jsx)("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap",marginBottom:"5px"},children:L.vehiclePics&&L.vehiclePics.map((e,t)=>(0,l.jsxs)("div",{style:{position:"relative",width:"40px",height:"40px"},children:[(0,l.jsx)("img",{src:e,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),(0,l.jsx)("button",{onClick:()=>{let e=L.vehiclePics.filter((e,i)=>i!==t);M({...L,vehiclePics:e})},style:{position:"absolute",top:-5,right:-5,background:"red",color:"white",border:"none",borderRadius:"50%",width:"15px",height:"15px",fontSize:"10px",cursor:"pointer"},children:"✕"})]},t))}),(0,l.jsx)("input",{type:"file",multiple:!0,onChange:e=>handleMultipleFileUploads(e,e=>M({...L,vehiclePics:e}),L.vehiclePics)}),(0,l.jsxs)("span",{style:{fontSize:10},children:[(null===(t=L.vehiclePics)||void 0===t?void 0:t.length)||0,"/6 pics"]})]}),(0,l.jsxs)("div",{style:s,children:[(0,l.jsx)("label",{style:d,children:"Update ID Document"}),(0,l.jsx)("input",{type:"file",onChange:e=>handleFileUpload(e,e=>M({...L,idPic:e}))})]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:8,marginTop:10},children:[(0,l.jsx)("button",{onClick:saveEdit,style:{background:"#2d9a4a",color:"#fff",padding:"8px 16px",borderRadius:4,border:"none",cursor:"pointer"},children:"Save"}),(0,l.jsx)("button",{onClick:()=>J(null),style:{background:"#6b7280",color:"#fff",padding:"8px 16px",borderRadius:4,border:"none",cursor:"pointer"},children:"Cancel"})]})]}):(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:15,alignItems:"center"},children:[(0,l.jsx)("img",{src:e.profilePhoto||"/default-avatar.png",style:{width:50,height:50,borderRadius:"50%",objectFit:"cover",background:"#eee"}}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{style:{fontSize:18},children:e.name}),(0,l.jsx)("div",{style:{fontSize:14,color:"#4b5563"},children:e.companyName||"Independent"}),(0,l.jsxs)("div",{style:{fontSize:12,color:"#6b7280"},children:["\uD83D\uDCCD ",e.serviceAreas||"No areas"]})]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:10},children:[(0,l.jsx)("button",{onClick:()=>(function(e){J(e.id);let t=[];try{t=e.vehiclePics?JSON.parse(e.vehiclePics):[],Array.isArray(t)||(t=[e.vehiclePics])}catch(i){t=e.vehiclePics?[e.vehiclePics]:[]}M({...e,name:e.name||"",companyName:e.companyName||"",email:e.email||"",phone:e.phone||"",serviceAreas:e.serviceAreas||"",facebook:e.facebook||"",instagram:e.instagram||"",vehiclePics:t})})(e),style:{background:"#3b82f6",color:"#fff",border:"none",padding:"8px 14px",borderRadius:6,cursor:"pointer"},children:"Edit"}),(0,l.jsx)("button",{onClick:()=>deleteProfile(e.id),style:{background:"#ef4444",color:"#fff",border:"none",padding:"8px 14px",borderRadius:6,cursor:"pointer"},children:"Delete"})]})]})},e.id)})]})]}):(0,l.jsx)("div",{style:{padding:50,textAlign:"center"},children:"Loading session..."})}i(1664);let n={padding:"10px",borderRadius:"6px",border:"1px solid #ccc",outline:"none",fontSize:"14px"},o={background:"#2d9a4a",color:"#fff",padding:"12px",borderRadius:"6px",border:"none",cursor:"pointer",fontWeight:"bold"},s={background:"#fff",padding:"10px",borderRadius:"6px",border:"1px solid #ddd",display:"flex",flexDirection:"column",gap:"5px"},d={fontSize:"12px",fontWeight:"bold",color:"#166534"}},1163:function(e,t,i){e.exports=i(9974)}},function(e){e.O(0,[774,664,888,179],function(){return e(e.s=1075)}),_N_E=e.O()}]);